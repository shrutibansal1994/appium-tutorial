'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _libWebviewHelpers = require('../../../lib/webview-helpers');

var _libWebviewHelpers2 = _interopRequireDefault(_libWebviewHelpers);

var _libCommandsContext = require('../../../lib/commands/context');

var _ = require('../../..');

var _2 = _interopRequireDefault(_);

var _appiumChromedriver = require('appium-chromedriver');

var _appiumChromedriver2 = _interopRequireDefault(_appiumChromedriver);

var _portfinder = require('portfinder');

var _portfinder2 = _interopRequireDefault(_portfinder);

var _appiumBaseDriver = require('appium-base-driver');

var driver = undefined;
var stubbedChromedriver = undefined;
var sandbox = _sinon2['default'].createSandbox();
var expect = _chai2['default'].expect;
_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('Context', function () {
  beforeEach(function () {
    sandbox.stub(_portfinder2['default'], 'getPort').callsFake(function (cb) {
      // eslint-disable-line promise/prefer-await-to-callbacks
      return cb(null, 4444); // eslint-disable-line promise/prefer-await-to-callbacks
    });
    driver = new _2['default']();
    driver.adb = sandbox.stub();
    driver.adb.curDeviceId = 'device_id';
    driver.adb.getAdbServerPort = sandbox.stub().returns(5555);
    sandbox.stub(_appiumChromedriver2['default'].prototype, 'restart');
    sandbox.stub(_appiumChromedriver2['default'].prototype, 'start');
    sandbox.stub(_appiumChromedriver2['default'].prototype.proxyReq, 'bind').returns('proxy');

    stubbedChromedriver = _sinon2['default'].stub();
    stubbedChromedriver.proxyReq = _sinon2['default'].stub();
    stubbedChromedriver.proxyReq.bind = _sinon2['default'].stub();
    stubbedChromedriver.restart = _sinon2['default'].stub();
    stubbedChromedriver.stop = sandbox.stub().throws();
    stubbedChromedriver.removeAllListeners = sandbox.stub();
  });
  afterEach(function () {
    sandbox.restore();
  });
  describe('getCurrentContext', function () {
    it('should return current context', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.curContext = 'current_context';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.getCurrentContext().should.become('current_context'));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should return NATIVE_APP if no context is set', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.curContext = null;
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.getCurrentContext().should.become(_libWebviewHelpers.NATIVE_WIN));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('getContexts', function () {
    it('should get Chromium context where appropriate', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = new _2['default']({ browserName: 'Chrome' });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.getContexts());

          case 3:
            context$3$0.t0 = context$3$0.sent;
            context$3$0.t1 = _libWebviewHelpers.CHROMIUM_WIN;
            expect(context$3$0.t0).to.include(context$3$0.t1);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should use ADB to figure out which webviews are available', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sandbox.stub(_libWebviewHelpers2['default'], 'getWebviews');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.getContexts());

          case 3:
            context$3$0.t0 = context$3$0.sent;
            context$3$0.t1 = _libWebviewHelpers.CHROMIUM_WIN;
            expect(context$3$0.t0).to.not.include(context$3$0.t1);

            _libWebviewHelpers2['default'].getWebviews.calledOnce.should.be['true'];

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('setContext', function () {
    beforeEach(function () {
      sandbox.stub(driver, 'getContexts').returns(['DEFAULT', 'WV', 'ANOTHER']);
      sandbox.stub(driver, 'switchContext');
    });
    it('should switch to default context if name is null', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sandbox.stub(driver, 'defaultContextName').returns('DEFAULT');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.setContext(null));

          case 3:
            driver.switchContext.calledWithExactly('DEFAULT').should.be['true'];
            driver.curContext.should.be.equal('DEFAULT');

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should switch to default web view if name is WEBVIEW', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sandbox.stub(driver, 'defaultWebviewName').returns('WV');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.setContext(_libWebviewHelpers.WEBVIEW_WIN));

          case 3:
            driver.switchContext.calledWithExactly('WV').should.be['true'];
            driver.curContext.should.be.equal('WV');

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should throw error if context does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.setContext('fake').should.be.rejectedWith(_appiumBaseDriver.errors.NoSuchContextError));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should not switch to context if already in it', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.curContext = 'ANOTHER';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.setContext('ANOTHER'));

          case 3:
            driver.switchContext.notCalled.should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('switchContext', function () {
    beforeEach(function () {
      sandbox.stub(driver, 'stopChromedriverProxies');
      sandbox.stub(driver, 'startChromedriverProxy');
      sandbox.stub(driver, 'suspendChromedriverProxy');
      sandbox.stub(driver, 'isChromedriverContext');
      driver.curContext = 'current_cntx';
    });
    it('should start chrome driver proxy if requested context is webview', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.isChromedriverContext.returns(true);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.switchContext('context'));

          case 3:
            driver.startChromedriverProxy.calledWithExactly('context').should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should stop chromedriver proxy if current context is webview and requested context is not', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.opts = { recreateChromeDriverSessions: true };
            driver.isChromedriverContext.withArgs('requested_cntx').returns(false);
            driver.isChromedriverContext.withArgs('current_cntx').returns(true);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.switchContext('requested_cntx'));

          case 5:
            driver.stopChromedriverProxies.calledOnce.should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should suspend chrome driver proxy if current context is webview and requested context is not', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.opts = { recreateChromeDriverSessions: false };
            driver.isChromedriverContext.withArgs('requested_cntx').returns(false);
            driver.isChromedriverContext.withArgs('current_cntx').returns(true);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.switchContext('requested_cntx'));

          case 5:
            driver.suspendChromedriverProxy.calledOnce.should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should throw error if requested and current context are not webview', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.isChromedriverContext.withArgs('requested_cntx').returns(false);
            driver.isChromedriverContext.withArgs('current_cntx').returns(false);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.switchContext('requested_cntx').should.be.rejectedWith(/switching to context/));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('defaultContextName', function () {
    it('should return NATIVE_WIN', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.defaultContextName().should.be.equal(_libWebviewHelpers.NATIVE_WIN));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('defaultWebviewName', function () {
    it('should return WEBVIEW with package', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.opts = { appPackage: 'pkg' };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.defaultWebviewName().should.be.equal(_libWebviewHelpers.WEBVIEW_BASE + 'pkg'));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('isWebContext', function () {
    it('should return true if current context is not native', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.curContext = 'current_context';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.isWebContext().should.be['true']);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('startChromedriverProxy', function () {
    beforeEach(function () {
      sandbox.stub(driver, 'onChromedriverStop');
    });
    it('should start new chromedriver session', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_1'));

          case 2:
            driver.sessionChromedrivers.WEBVIEW_1.should.be.equal(driver.chromedriver);
            driver.chromedriver.start.getCall(0).args[0].chromeOptions.androidDeviceSerial.should.be.equal('device_id');
            driver.chromedriver.proxyPort.should.be.equal(4444);
            driver.chromedriver.proxyReq.bind.calledWithExactly(driver.chromedriver);
            driver.proxyReqRes.should.be.equal('proxy');
            driver.jwpProxyActive.should.be['true'];

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to extract package from context name', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.opts.appPackage = 'pkg';
            driver.opts.extractChromeAndroidPackageFromContextName = true;
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_com.pkg'));

          case 4:
            driver.chromedriver.start.getCall(0).args[0].chromeOptions.should.be.deep.include({ androidPackage: 'com.pkg' });

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should use package from opts if package extracted from context is empty', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.opts.appPackage = 'pkg';
            driver.opts.extractChromeAndroidPackageFromContextName = true;
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_'));

          case 4:
            driver.chromedriver.start.getCall(0).args[0].chromeOptions.should.be.deep.include({ androidPackage: 'pkg' });

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should handle chromedriver event with STATE_STOPPED state', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_1'));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.chromedriver.emit(_appiumChromedriver2['default'].EVENT_CHANGED, { state: _appiumChromedriver2['default'].STATE_STOPPED }));

          case 4:
            driver.onChromedriverStop.calledWithExactly('WEBVIEW_1').should.be['true'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should ignore events if status is not STATE_STOPPED', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_1'));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.chromedriver.emit(_appiumChromedriver2['default'].EVENT_CHANGED, { state: 'unhandled_state' }));

          case 4:
            driver.onChromedriverStop.notCalled.should.be['true'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should reconnect if session already exists', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            stubbedChromedriver.hasWorkingWebview = _sinon2['default'].stub().returns(true);
            driver.sessionChromedrivers = { WEBVIEW_1: stubbedChromedriver };
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_1'));

          case 4:
            driver.chromedriver.restart.notCalled.should.be['true'];
            driver.chromedriver.should.be.equal(stubbedChromedriver);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should restart if chromedriver has not working web view', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            stubbedChromedriver.hasWorkingWebview = _sinon2['default'].stub().returns(false);
            driver.sessionChromedrivers = { WEBVIEW_1: stubbedChromedriver };
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startChromedriverProxy('WEBVIEW_1'));

          case 4:
            driver.chromedriver.restart.calledOnce.should.be['true'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('suspendChromedriverProxy', function () {
    it('should suspend chrome driver proxy', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.suspendChromedriverProxy());

          case 2:
            (driver.chromedriver == null).should.be['true'];
            (driver.proxyReqRes == null).should.be['true'];
            driver.jwpProxyActive.should.be['false'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('onChromedriverStop', function () {
    it('should call startUnexpectedShutdown if chromedriver in active context', function callee$2$0() {
      var arg0;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            _sinon2['default'].stub(driver, 'startUnexpectedShutdown');
            driver.curContext = 'WEBVIEW_1';
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.onChromedriverStop('WEBVIEW_1'));

          case 4:
            arg0 = driver.startUnexpectedShutdown.getCall(0).args[0];

            arg0.should.be.an('error');
            arg0.message.should.include('Chromedriver quit unexpectedly during session');

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should delete session if chromedriver in non-active context', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.curContext = 'WEBVIEW_1';
            driver.sessionChromedrivers = { WEBVIEW_2: 'CHROMIUM' };
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.onChromedriverStop('WEBVIEW_2'));

          case 4:
            driver.sessionChromedrivers.should.be.empty;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('stopChromedriverProxies', function () {
    it('should stop all chromedriver', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver.sessionChromedrivers = { WEBVIEW_1: stubbedChromedriver, WEBVIEW_2: stubbedChromedriver };
            sandbox.stub(driver, 'suspendChromedriverProxy');
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.stopChromedriverProxies());

          case 4:
            driver.suspendChromedriverProxy.calledOnce.should.be['true'];
            stubbedChromedriver.removeAllListeners.calledWithExactly(_appiumChromedriver2['default'].EVENT_CHANGED).should.be['true'];
            stubbedChromedriver.removeAllListeners.calledTwice.should.be['true'];
            stubbedChromedriver.stop.calledTwice.should.be['true'];
            driver.sessionChromedrivers.should.be.empty;

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('isChromedriverContext', function () {
    it('should return true if context is webview or chromium', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.isChromedriverContext(_libWebviewHelpers.WEBVIEW_WIN + '_1').should.be['true']);

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.isChromedriverContext(_libWebviewHelpers.CHROMIUM_WIN).should.be['true']);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
  describe('setupNewChromedriver', function () {
    it('should be able to set app package from chrome options', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ chromeOptions: { androidPackage: 'apkg' } }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidPackage.should.be.equal('apkg');

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should use prefixed chromeOptions', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({
              'goog:chromeOptions': {
                androidPackage: 'apkg'
              }
            }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidPackage.should.be.equal('apkg');

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should merge chromeOptions', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({
              chromeOptions: {
                androidPackage: 'apkg'
              },
              'goog:chromeOptions': {
                androidWaitPackage: 'bpkg'
              },
              'appium:chromeOptions': {
                androidActivity: 'aact'
              }
            }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidPackage.should.be.equal('apkg');
            chromedriver.start.getCall(0).args[0].chromeOptions.androidActivity.should.be.equal('aact');
            chromedriver.start.getCall(0).args[0].chromeOptions.androidWaitPackage.should.be.equal('bpkg');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to set androidActivity chrome option', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ chromeAndroidActivity: 'act' }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidActivity.should.be.equal('act');

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to set androidProcess chrome option', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ chromeAndroidProcess: 'proc' }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidProcess.should.be.equal('proc');

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to set loggingPrefs capability', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ enablePerformanceLogging: true }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].loggingPrefs.should.deep.equal({ performance: 'ALL' });

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should set androidActivity to appActivity if browser name is chromium-webview', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ browserName: 'chromium-webview',
              appActivity: 'app_act' }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].chromeOptions.androidActivity.should.be.equal('app_act');

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to set loggingPrefs capability', function callee$2$0() {
      var chromedriver;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libCommandsContext.setupNewChromedriver)({ pageLoadStrategy: "strategy" }));

          case 2:
            chromedriver = context$3$0.sent;

            chromedriver.start.getCall(0).args[0].pageLoadStrategy.should.be.equal("strategy");

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jb21tYW5kcy9jb250ZXh0LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7cUJBQzNCLE9BQU87Ozs7aUNBRTJDLDhCQUE4Qjs7OztrQ0FDN0QsK0JBQStCOztnQkFDMUMsVUFBVTs7OztrQ0FDWCxxQkFBcUI7Ozs7MEJBQ3ZCLFlBQVk7Ozs7Z0NBQ1osb0JBQW9COztBQUUzQyxJQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsSUFBSSxtQkFBbUIsWUFBQSxDQUFDO0FBQ3hCLElBQUksT0FBTyxHQUFHLG1CQUFNLGFBQWEsRUFBRSxDQUFDO0FBQ3BDLElBQUksTUFBTSxHQUFHLGtCQUFLLE1BQU0sQ0FBQztBQUN6QixrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxTQUFTLEVBQUUsWUFBWTtBQUM5QixZQUFVLENBQUMsWUFBWTtBQUNyQixXQUFPLENBQUMsSUFBSSwwQkFBYSxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLEVBQUU7O0FBQzFELGFBQU8sRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN2QixDQUFDLENBQUM7QUFDSCxVQUFNLEdBQUcsbUJBQW1CLENBQUM7QUFDN0IsVUFBTSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDNUIsVUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0FBQ3JDLFVBQU0sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMzRCxXQUFPLENBQUMsSUFBSSxDQUFDLGdDQUFhLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNoRCxXQUFPLENBQUMsSUFBSSxDQUFDLGdDQUFh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QyxZQUFZOzs7Ozs2Q0FBUyw4Q0FBcUIsRUFBQyxnQkFBZ0IsRUFBRSxVQUFVLEVBQUMsQ0FBQzs7O0FBQXpFLHdCQUFZOztBQUNoQix3QkFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUNuRCxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQzs7Ozs7OztLQUNoQyxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L2NvbW1hbmRzL2NvbnRleHQtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIHdlYnZpZXdIZWxwZXJzLFxuICAgICAgICAgTkFUSVZFX1dJTiwgV0VCVklFV19CQVNFLCBXRUJWSUVXX1dJTiwgQ0hST01JVU1fV0lOIH0gZnJvbSAnLi4vLi4vLi4vbGliL3dlYnZpZXctaGVscGVycyc7XG5pbXBvcnQgeyBzZXR1cE5ld0Nocm9tZWRyaXZlciB9IGZyb20gJy4uLy4uLy4uL2xpYi9jb21tYW5kcy9jb250ZXh0JztcbmltcG9ydCBBbmRyb2lkRHJpdmVyIGZyb20gJy4uLy4uLy4uJztcbmltcG9ydCBDaHJvbWVkcml2ZXIgZnJvbSAnYXBwaXVtLWNocm9tZWRyaXZlcic7XG5pbXBvcnQgUG9ydEZpbmRlciBmcm9tICdwb3J0ZmluZGVyJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5cbmxldCBkcml2ZXI7XG5sZXQgc3R1YmJlZENocm9tZWRyaXZlcjtcbmxldCBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xubGV0IGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ0NvbnRleHQnLCBmdW5jdGlvbiAoKSB7XG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIHNhbmRib3guc3R1YihQb3J0RmluZGVyLCAnZ2V0UG9ydCcpLmNhbGxzRmFrZShmdW5jdGlvbiAoY2IpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3NcbiAgICAgIHJldHVybiBjYihudWxsLCA0NDQ0KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3NcbiAgICB9KTtcbiAgICBkcml2ZXIgPSBuZXcgQW5kcm9pZERyaXZlcigpO1xuICAgIGRyaXZlci5hZGIgPSBzYW5kYm94LnN0dWIoKTtcbiAgICBkcml2ZXIuYWRiLmN1ckRldmljZUlkID0gJ2RldmljZV9pZCc7XG4gICAgZHJpdmVyLmFkYi5nZXRBZGJTZXJ2ZXJQb3J0ID0gc2FuZGJveC5zdHViKCkucmV0dXJucyg1NTU1KTtcbiAgICBzYW5kYm94LnN0dWIoQ2hyb21lZHJpdmVyLnByb3RvdHlwZSwgJ3Jlc3RhcnQnKTtcbiAgICBzYW5kYm94LnN0dWIoQ2hyb21lZHJpdmVyLnByb3RvdHlwZSwgJ3N0YXJ0Jyk7XG4gICAgc2FuZGJveC5zdHViKENocm9tZWRyaXZlci5wcm90b3R5cGUucHJveHlSZXEsICdiaW5kJykucmV0dXJucygncHJveHknKTtcblxuICAgIHN0dWJiZWRDaHJvbWVkcml2ZXIgPSBzaW5vbi5zdHViKCk7XG4gICAgc3R1YmJlZENocm9tZWRyaXZlci5wcm94eVJlcSA9IHNpbm9uLnN0dWIoKTtcbiAgICBzdHViYmVkQ2hyb21lZHJpdmVyLnByb3h5UmVxLmJpbmQgPSBzaW5vbi5zdHViKCk7XG4gICAgc3R1YmJlZENocm9tZWRyaXZlci5yZXN0YXJ0ID0gc2lub24uc3R1YigpO1xuICAgIHN0dWJiZWRDaHJvbWVkcml2ZXIuc3RvcCA9IHNhbmRib3guc3R1YigpLnRocm93cygpO1xuICAgIHN0dWJiZWRDaHJvbWVkcml2ZXIucmVtb3ZlQWxsTGlzdGVuZXJzID0gc2FuZGJveC5zdHViKCk7XG4gIH0pO1xuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dldEN1cnJlbnRDb250ZXh0JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgY29udGV4dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0ID0gJ2N1cnJlbnRfY29udGV4dCc7XG4gICAgICBhd2FpdCBkcml2ZXIuZ2V0Q3VycmVudENvbnRleHQoKS5zaG91bGQuYmVjb21lKCdjdXJyZW50X2NvbnRleHQnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBOQVRJVkVfQVBQIGlmIG5vIGNvbnRleHQgaXMgc2V0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLmN1ckNvbnRleHQgPSBudWxsO1xuICAgICAgYXdhaXQgZHJpdmVyLmdldEN1cnJlbnRDb250ZXh0KCkuc2hvdWxkLmJlY29tZShOQVRJVkVfV0lOKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZXRDb250ZXh0cycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGdldCBDaHJvbWl1bSBjb250ZXh0IHdoZXJlIGFwcHJvcHJpYXRlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyID0gbmV3IEFuZHJvaWREcml2ZXIoe2Jyb3dzZXJOYW1lOiAnQ2hyb21lJ30pO1xuICAgICAgZXhwZWN0KGF3YWl0IGRyaXZlci5nZXRDb250ZXh0cygpKS50by5pbmNsdWRlKENIUk9NSVVNX1dJTik7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB1c2UgQURCIHRvIGZpZ3VyZSBvdXQgd2hpY2ggd2Vidmlld3MgYXJlIGF2YWlsYWJsZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNhbmRib3guc3R1Yih3ZWJ2aWV3SGVscGVycywgJ2dldFdlYnZpZXdzJyk7XG4gICAgICBleHBlY3QoYXdhaXQgZHJpdmVyLmdldENvbnRleHRzKCkpLnRvLm5vdC5pbmNsdWRlKENIUk9NSVVNX1dJTik7XG4gICAgICB3ZWJ2aWV3SGVscGVycy5nZXRXZWJ2aWV3cy5jYWxsZWRPbmNlLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ3NldENvbnRleHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBzYW5kYm94LnN0dWIoZHJpdmVyLCAnZ2V0Q29udGV4dHMnKS5yZXR1cm5zKFsnREVGQVVMVCcsICdXVicsICdBTk9USEVSJ10pO1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ3N3aXRjaENvbnRleHQnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHN3aXRjaCB0byBkZWZhdWx0IGNvbnRleHQgaWYgbmFtZSBpcyBudWxsJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ2RlZmF1bHRDb250ZXh0TmFtZScpLnJldHVybnMoJ0RFRkFVTFQnKTtcbiAgICAgIGF3YWl0IGRyaXZlci5zZXRDb250ZXh0KG51bGwpO1xuICAgICAgZHJpdmVyLnN3aXRjaENvbnRleHQuY2FsbGVkV2l0aEV4YWN0bHkoJ0RFRkFVTFQnKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0LnNob3VsZC5iZS5lcXVhbCgnREVGQVVMVCcpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc3dpdGNoIHRvIGRlZmF1bHQgd2ViIHZpZXcgaWYgbmFtZSBpcyBXRUJWSUVXJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ2RlZmF1bHRXZWJ2aWV3TmFtZScpLnJldHVybnMoJ1dWJyk7XG4gICAgICBhd2FpdCBkcml2ZXIuc2V0Q29udGV4dChXRUJWSUVXX1dJTik7XG4gICAgICBkcml2ZXIuc3dpdGNoQ29udGV4dC5jYWxsZWRXaXRoRXhhY3RseSgnV1YnKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0LnNob3VsZC5iZS5lcXVhbCgnV1YnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGNvbnRleHQgZG9lcyBub3QgZXhpc3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBkcml2ZXIuc2V0Q29udGV4dCgnZmFrZScpXG4gICAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IHN3aXRjaCB0byBjb250ZXh0IGlmIGFscmVhZHkgaW4gaXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIuY3VyQ29udGV4dCA9ICdBTk9USEVSJztcbiAgICAgIGF3YWl0IGRyaXZlci5zZXRDb250ZXh0KCdBTk9USEVSJyk7XG4gICAgICBkcml2ZXIuc3dpdGNoQ29udGV4dC5ub3RDYWxsZWQuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnc3dpdGNoQ29udGV4dCcsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHNhbmRib3guc3R1Yihkcml2ZXIsICdzdG9wQ2hyb21lZHJpdmVyUHJveGllcycpO1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ3N0YXJ0Q2hyb21lZHJpdmVyUHJveHknKTtcbiAgICAgIHNhbmRib3guc3R1Yihkcml2ZXIsICdzdXNwZW5kQ2hyb21lZHJpdmVyUHJveHknKTtcbiAgICAgIHNhbmRib3guc3R1Yihkcml2ZXIsICdpc0Nocm9tZWRyaXZlckNvbnRleHQnKTtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0ID0gJ2N1cnJlbnRfY250eCc7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBzdGFydCBjaHJvbWUgZHJpdmVyIHByb3h5IGlmIHJlcXVlc3RlZCBjb250ZXh0IGlzIHdlYnZpZXcnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIuaXNDaHJvbWVkcml2ZXJDb250ZXh0LnJldHVybnModHJ1ZSk7XG4gICAgICBhd2FpdCBkcml2ZXIuc3dpdGNoQ29udGV4dCgnY29udGV4dCcpO1xuICAgICAgZHJpdmVyLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkuY2FsbGVkV2l0aEV4YWN0bHkoJ2NvbnRleHQnKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHN0b3AgY2hyb21lZHJpdmVyIHByb3h5IGlmIGN1cnJlbnQgY29udGV4dCBpcyB3ZWJ2aWV3IGFuZCByZXF1ZXN0ZWQgY29udGV4dCBpcyBub3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIub3B0cyA9IHtyZWNyZWF0ZUNocm9tZURyaXZlclNlc3Npb25zOiB0cnVlfTtcbiAgICAgIGRyaXZlci5pc0Nocm9tZWRyaXZlckNvbnRleHQud2l0aEFyZ3MoJ3JlcXVlc3RlZF9jbnR4JykucmV0dXJucyhmYWxzZSk7XG4gICAgICBkcml2ZXIuaXNDaHJvbWVkcml2ZXJDb250ZXh0LndpdGhBcmdzKCdjdXJyZW50X2NudHgnKS5yZXR1cm5zKHRydWUpO1xuICAgICAgYXdhaXQgZHJpdmVyLnN3aXRjaENvbnRleHQoJ3JlcXVlc3RlZF9jbnR4Jyk7XG4gICAgICBkcml2ZXIuc3RvcENocm9tZWRyaXZlclByb3hpZXMuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHN1c3BlbmQgY2hyb21lIGRyaXZlciBwcm94eSBpZiBjdXJyZW50IGNvbnRleHQgaXMgd2VidmlldyBhbmQgcmVxdWVzdGVkIGNvbnRleHQgaXMgbm90JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLm9wdHMgPSB7cmVjcmVhdGVDaHJvbWVEcml2ZXJTZXNzaW9uczogZmFsc2V9O1xuICAgICAgZHJpdmVyLmlzQ2hyb21lZHJpdmVyQ29udGV4dC53aXRoQXJncygncmVxdWVzdGVkX2NudHgnKS5yZXR1cm5zKGZhbHNlKTtcbiAgICAgIGRyaXZlci5pc0Nocm9tZWRyaXZlckNvbnRleHQud2l0aEFyZ3MoJ2N1cnJlbnRfY250eCcpLnJldHVybnModHJ1ZSk7XG4gICAgICBhd2FpdCBkcml2ZXIuc3dpdGNoQ29udGV4dCgncmVxdWVzdGVkX2NudHgnKTtcbiAgICAgIGRyaXZlci5zdXNwZW5kQ2hyb21lZHJpdmVyUHJveHkuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIHJlcXVlc3RlZCBhbmQgY3VycmVudCBjb250ZXh0IGFyZSBub3Qgd2VidmlldycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5pc0Nocm9tZWRyaXZlckNvbnRleHQud2l0aEFyZ3MoJ3JlcXVlc3RlZF9jbnR4JykucmV0dXJucyhmYWxzZSk7XG4gICAgICBkcml2ZXIuaXNDaHJvbWVkcml2ZXJDb250ZXh0LndpdGhBcmdzKCdjdXJyZW50X2NudHgnKS5yZXR1cm5zKGZhbHNlKTtcbiAgICAgIGF3YWl0IGRyaXZlci5zd2l0Y2hDb250ZXh0KCdyZXF1ZXN0ZWRfY250eCcpXG4gICAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9zd2l0Y2hpbmcgdG8gY29udGV4dC8pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2RlZmF1bHRDb250ZXh0TmFtZScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBOQVRJVkVfV0lOJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgZHJpdmVyLmRlZmF1bHRDb250ZXh0TmFtZSgpLnNob3VsZC5iZS5lcXVhbChOQVRJVkVfV0lOKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdkZWZhdWx0V2Vidmlld05hbWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gV0VCVklFVyB3aXRoIHBhY2thZ2UnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIub3B0cyA9IHthcHBQYWNrYWdlOiAncGtnJ307XG4gICAgICBhd2FpdCBkcml2ZXIuZGVmYXVsdFdlYnZpZXdOYW1lKCkuc2hvdWxkLmJlLmVxdWFsKFdFQlZJRVdfQkFTRSArICdwa2cnKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdpc1dlYkNvbnRleHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSBpZiBjdXJyZW50IGNvbnRleHQgaXMgbm90IG5hdGl2ZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0ID0gJ2N1cnJlbnRfY29udGV4dCc7XG4gICAgICBhd2FpdCBkcml2ZXIuaXNXZWJDb250ZXh0KCkuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnc3RhcnRDaHJvbWVkcml2ZXJQcm94eScsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHNhbmRib3guc3R1Yihkcml2ZXIsICdvbkNocm9tZWRyaXZlclN0b3AnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IG5ldyBjaHJvbWVkcml2ZXIgc2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IGRyaXZlci5zdGFydENocm9tZWRyaXZlclByb3h5KCdXRUJWSUVXXzEnKTtcbiAgICAgIGRyaXZlci5zZXNzaW9uQ2hyb21lZHJpdmVycy5XRUJWSUVXXzEuc2hvdWxkLmJlLmVxdWFsKGRyaXZlci5jaHJvbWVkcml2ZXIpO1xuICAgICAgZHJpdmVyLmNocm9tZWRyaXZlci5zdGFydC5nZXRDYWxsKDApLmFyZ3NbMF1cbiAgICAgICAgLmNocm9tZU9wdGlvbnMuYW5kcm9pZERldmljZVNlcmlhbC5zaG91bGQuYmUuZXF1YWwoJ2RldmljZV9pZCcpO1xuICAgICAgZHJpdmVyLmNocm9tZWRyaXZlci5wcm94eVBvcnQuc2hvdWxkLmJlLmVxdWFsKDQ0NDQpO1xuICAgICAgZHJpdmVyLmNocm9tZWRyaXZlci5wcm94eVJlcS5iaW5kLmNhbGxlZFdpdGhFeGFjdGx5KGRyaXZlci5jaHJvbWVkcml2ZXIpO1xuICAgICAgZHJpdmVyLnByb3h5UmVxUmVzLnNob3VsZC5iZS5lcXVhbCgncHJveHknKTtcbiAgICAgIGRyaXZlci5qd3BQcm94eUFjdGl2ZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gZXh0cmFjdCBwYWNrYWdlIGZyb20gY29udGV4dCBuYW1lJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLm9wdHMuYXBwUGFja2FnZSA9ICdwa2cnO1xuICAgICAgZHJpdmVyLm9wdHMuZXh0cmFjdENocm9tZUFuZHJvaWRQYWNrYWdlRnJvbUNvbnRleHROYW1lID0gdHJ1ZTtcbiAgICAgIGF3YWl0IGRyaXZlci5zdGFydENocm9tZWRyaXZlclByb3h5KCdXRUJWSUVXX2NvbS5wa2cnKTtcbiAgICAgIGRyaXZlci5jaHJvbWVkcml2ZXIuc3RhcnQuZ2V0Q2FsbCgwKS5hcmdzWzBdXG4gICAgICAgIC5jaHJvbWVPcHRpb25zLnNob3VsZC5iZS5kZWVwLmluY2x1ZGUoe2FuZHJvaWRQYWNrYWdlOiAnY29tLnBrZyd9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHVzZSBwYWNrYWdlIGZyb20gb3B0cyBpZiBwYWNrYWdlIGV4dHJhY3RlZCBmcm9tIGNvbnRleHQgaXMgZW1wdHknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIub3B0cy5hcHBQYWNrYWdlID0gJ3BrZyc7XG4gICAgICBkcml2ZXIub3B0cy5leHRyYWN0Q2hyb21lQW5kcm9pZFBhY2thZ2VGcm9tQ29udGV4dE5hbWUgPSB0cnVlO1xuICAgICAgYXdhaXQgZHJpdmVyLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkoJ1dFQlZJRVdfJyk7XG4gICAgICBkcml2ZXIuY2hyb21lZHJpdmVyLnN0YXJ0LmdldENhbGwoMCkuYXJnc1swXVxuICAgICAgICAuY2hyb21lT3B0aW9ucy5zaG91bGQuYmUuZGVlcC5pbmNsdWRlKHthbmRyb2lkUGFja2FnZTogJ3BrZyd9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjaHJvbWVkcml2ZXIgZXZlbnQgd2l0aCBTVEFURV9TVE9QUEVEIHN0YXRlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgZHJpdmVyLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkoJ1dFQlZJRVdfMScpO1xuICAgICAgYXdhaXQgZHJpdmVyLmNocm9tZWRyaXZlci5lbWl0KENocm9tZWRyaXZlci5FVkVOVF9DSEFOR0VELFxuICAgICAgICB7c3RhdGU6IENocm9tZWRyaXZlci5TVEFURV9TVE9QUEVEfSk7XG4gICAgICBkcml2ZXIub25DaHJvbWVkcml2ZXJTdG9wLmNhbGxlZFdpdGhFeGFjdGx5KCdXRUJWSUVXXzEnKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGlnbm9yZSBldmVudHMgaWYgc3RhdHVzIGlzIG5vdCBTVEFURV9TVE9QUEVEJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgZHJpdmVyLnN0YXJ0Q2hyb21lZHJpdmVyUHJveHkoJ1dFQlZJRVdfMScpO1xuICAgICAgYXdhaXQgZHJpdmVyLmNocm9tZWRyaXZlci5lbWl0KENocm9tZWRyaXZlci5FVkVOVF9DSEFOR0VELFxuICAgICAgICB7c3RhdGU6ICd1bmhhbmRsZWRfc3RhdGUnfSk7XG4gICAgICBkcml2ZXIub25DaHJvbWVkcml2ZXJTdG9wLm5vdENhbGxlZC5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJlY29ubmVjdCBpZiBzZXNzaW9uIGFscmVhZHkgZXhpc3RzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgc3R1YmJlZENocm9tZWRyaXZlci5oYXNXb3JraW5nV2VidmlldyA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKHRydWUpO1xuICAgICAgZHJpdmVyLnNlc3Npb25DaHJvbWVkcml2ZXJzID0ge1dFQlZJRVdfMTogc3R1YmJlZENocm9tZWRyaXZlcn07XG4gICAgICBhd2FpdCBkcml2ZXIuc3RhcnRDaHJvbWVkcml2ZXJQcm94eSgnV0VCVklFV18xJyk7XG4gICAgICBkcml2ZXIuY2hyb21lZHJpdmVyLnJlc3RhcnQubm90Q2FsbGVkLnNob3VsZC5iZS50cnVlO1xuICAgICAgZHJpdmVyLmNocm9tZWRyaXZlci5zaG91bGQuYmUuZXF1YWwoc3R1YmJlZENocm9tZWRyaXZlcik7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXN0YXJ0IGlmIGNocm9tZWRyaXZlciBoYXMgbm90IHdvcmtpbmcgd2ViIHZpZXcnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBzdHViYmVkQ2hyb21lZHJpdmVyLmhhc1dvcmtpbmdXZWJ2aWV3ID0gc2lub24uc3R1YigpLnJldHVybnMoZmFsc2UpO1xuICAgICAgZHJpdmVyLnNlc3Npb25DaHJvbWVkcml2ZXJzID0ge1dFQlZJRVdfMTogc3R1YmJlZENocm9tZWRyaXZlcn07XG4gICAgICBhd2FpdCBkcml2ZXIuc3RhcnRDaHJvbWVkcml2ZXJQcm94eSgnV0VCVklFV18xJyk7XG4gICAgICBkcml2ZXIuY2hyb21lZHJpdmVyLnJlc3RhcnQuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdzdXNwZW5kQ2hyb21lZHJpdmVyUHJveHknLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBzdXNwZW5kIGNocm9tZSBkcml2ZXIgcHJveHknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBkcml2ZXIuc3VzcGVuZENocm9tZWRyaXZlclByb3h5KCk7XG4gICAgICAoZHJpdmVyLmNocm9tZWRyaXZlciA9PSBudWxsKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIChkcml2ZXIucHJveHlSZXFSZXMgPT0gbnVsbCkuc2hvdWxkLmJlLnRydWU7XG4gICAgICBkcml2ZXIuandwUHJveHlBY3RpdmUuc2hvdWxkLmJlLmZhbHNlO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ29uQ2hyb21lZHJpdmVyU3RvcCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGNhbGwgc3RhcnRVbmV4cGVjdGVkU2h1dGRvd24gaWYgY2hyb21lZHJpdmVyIGluIGFjdGl2ZSBjb250ZXh0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgc2lub24uc3R1Yihkcml2ZXIsICdzdGFydFVuZXhwZWN0ZWRTaHV0ZG93bicpO1xuICAgICAgZHJpdmVyLmN1ckNvbnRleHQgPSAnV0VCVklFV18xJztcbiAgICAgIGF3YWl0IGRyaXZlci5vbkNocm9tZWRyaXZlclN0b3AoJ1dFQlZJRVdfMScpO1xuICAgICAgbGV0IGFyZzAgPSBkcml2ZXIuc3RhcnRVbmV4cGVjdGVkU2h1dGRvd24uZ2V0Q2FsbCgwKS5hcmdzWzBdO1xuICAgICAgYXJnMC5zaG91bGQuYmUuYW4oJ2Vycm9yJyk7XG4gICAgICBhcmcwLm1lc3NhZ2Uuc2hvdWxkLmluY2x1ZGUoJ0Nocm9tZWRyaXZlciBxdWl0IHVuZXhwZWN0ZWRseSBkdXJpbmcgc2Vzc2lvbicpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZGVsZXRlIHNlc3Npb24gaWYgY2hyb21lZHJpdmVyIGluIG5vbi1hY3RpdmUgY29udGV4dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5jdXJDb250ZXh0ID0gJ1dFQlZJRVdfMSc7XG4gICAgICBkcml2ZXIuc2Vzc2lvbkNocm9tZWRyaXZlcnMgPSB7V0VCVklFV18yOiAnQ0hST01JVU0nfTtcbiAgICAgIGF3YWl0IGRyaXZlci5vbkNocm9tZWRyaXZlclN0b3AoJ1dFQlZJRVdfMicpO1xuICAgICAgZHJpdmVyLnNlc3Npb25DaHJvbWVkcml2ZXJzLnNob3VsZC5iZS5lbXB0eTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdzdG9wQ2hyb21lZHJpdmVyUHJveGllcycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHN0b3AgYWxsIGNocm9tZWRyaXZlcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5zZXNzaW9uQ2hyb21lZHJpdmVycyA9IHtXRUJWSUVXXzE6IHN0dWJiZWRDaHJvbWVkcml2ZXIsIFdFQlZJRVdfMjogc3R1YmJlZENocm9tZWRyaXZlcn07XG4gICAgICBzYW5kYm94LnN0dWIoZHJpdmVyLCAnc3VzcGVuZENocm9tZWRyaXZlclByb3h5Jyk7XG4gICAgICBhd2FpdCBkcml2ZXIuc3RvcENocm9tZWRyaXZlclByb3hpZXMoKTtcbiAgICAgIGRyaXZlci5zdXNwZW5kQ2hyb21lZHJpdmVyUHJveHkuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHN0dWJiZWRDaHJvbWVkcml2ZXIucmVtb3ZlQWxsTGlzdGVuZXJzXG4gICAgICAgIC5jYWxsZWRXaXRoRXhhY3RseShDaHJvbWVkcml2ZXIuRVZFTlRfQ0hBTkdFRCkuc2hvdWxkLmJlLnRydWU7XG4gICAgICBzdHViYmVkQ2hyb21lZHJpdmVyLnJlbW92ZUFsbExpc3RlbmVycy5jYWxsZWRUd2ljZS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHN0dWJiZWRDaHJvbWVkcml2ZXIuc3RvcC5jYWxsZWRUd2ljZS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIGRyaXZlci5zZXNzaW9uQ2hyb21lZHJpdmVycy5zaG91bGQuYmUuZW1wdHk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnaXNDaHJvbWVkcml2ZXJDb250ZXh0JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgaWYgY29udGV4dCBpcyB3ZWJ2aWV3IG9yIGNocm9taXVtJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgZHJpdmVyLmlzQ2hyb21lZHJpdmVyQ29udGV4dChXRUJWSUVXX1dJTiArICdfMScpLnNob3VsZC5iZS50cnVlO1xuICAgICAgYXdhaXQgZHJpdmVyLmlzQ2hyb21lZHJpdmVyQ29udGV4dChDSFJPTUlVTV9XSU4pLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ3NldHVwTmV3Q2hyb21lZHJpdmVyJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBzZXQgYXBwIHBhY2thZ2UgZnJvbSBjaHJvbWUgb3B0aW9ucycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjaHJvbWVkcml2ZXIgPSBhd2FpdCBzZXR1cE5ld0Nocm9tZWRyaXZlcih7Y2hyb21lT3B0aW9uczoge2FuZHJvaWRQYWNrYWdlOiAnYXBrZyd9fSk7XG4gICAgICBjaHJvbWVkcml2ZXIuc3RhcnQuZ2V0Q2FsbCgwKS5hcmdzWzBdLmNocm9tZU9wdGlvbnMuYW5kcm9pZFBhY2thZ2VcbiAgICAgICAgLnNob3VsZC5iZS5lcXVhbCgnYXBrZycpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdXNlIHByZWZpeGVkIGNocm9tZU9wdGlvbnMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgY2hyb21lZHJpdmVyID0gYXdhaXQgc2V0dXBOZXdDaHJvbWVkcml2ZXIoe1xuICAgICAgICAnZ29vZzpjaHJvbWVPcHRpb25zJzoge1xuICAgICAgICAgIGFuZHJvaWRQYWNrYWdlOiAnYXBrZycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNocm9tZWRyaXZlci5zdGFydC5nZXRDYWxsKDApLmFyZ3NbMF0uY2hyb21lT3B0aW9ucy5hbmRyb2lkUGFja2FnZVxuICAgICAgICAuc2hvdWxkLmJlLmVxdWFsKCdhcGtnJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBtZXJnZSBjaHJvbWVPcHRpb25zJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGNocm9tZWRyaXZlciA9IGF3YWl0IHNldHVwTmV3Q2hyb21lZHJpdmVyKHtcbiAgICAgICAgY2hyb21lT3B0aW9uczoge1xuICAgICAgICAgIGFuZHJvaWRQYWNrYWdlOiAnYXBrZycsXG4gICAgICAgIH0sXG4gICAgICAgICdnb29nOmNocm9tZU9wdGlvbnMnOiB7XG4gICAgICAgICAgYW5kcm9pZFdhaXRQYWNrYWdlOiAnYnBrZycsXG4gICAgICAgIH0sXG4gICAgICAgICdhcHBpdW06Y2hyb21lT3B0aW9ucyc6IHtcbiAgICAgICAgICBhbmRyb2lkQWN0aXZpdHk6ICdhYWN0JyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY2hyb21lZHJpdmVyLnN0YXJ0LmdldENhbGwoMCkuYXJnc1swXS5jaHJvbWVPcHRpb25zLmFuZHJvaWRQYWNrYWdlXG4gICAgICAgIC5zaG91bGQuYmUuZXF1YWwoJ2Fwa2cnKTtcbiAgICAgIGNocm9tZWRyaXZlci5zdGFydC5nZXRDYWxsKDApLmFyZ3NbMF0uY2hyb21lT3B0aW9ucy5hbmRyb2lkQWN0aXZpdHlcbiAgICAgICAgLnNob3VsZC5iZS5lcXVhbCgnYWFjdCcpO1xuICAgICAgY2hyb21lZHJpdmVyLnN0YXJ0LmdldENhbGwoMCkuYXJnc1swXS5jaHJvbWVPcHRpb25zLmFuZHJvaWRXYWl0UGFja2FnZVxuICAgICAgICAuc2hvdWxkLmJlLmVxdWFsKCdicGtnJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHNldCBhbmRyb2lkQWN0aXZpdHkgY2hyb21lIG9wdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjaHJvbWVkcml2ZXIgPSBhd2FpdCBzZXR1cE5ld0Nocm9tZWRyaXZlcih7Y2hyb21lQW5kcm9pZEFjdGl2aXR5OiAnYWN0J30pO1xuICAgICAgY2hyb21lZHJpdmVyLnN0YXJ0LmdldENhbGwoMCkuYXJnc1swXS5jaHJvbWVPcHRpb25zLmFuZHJvaWRBY3Rpdml0eVxuICAgICAgICAuc2hvdWxkLmJlLmVxdWFsKCdhY3QnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gc2V0IGFuZHJvaWRQcm9jZXNzIGNocm9tZSBvcHRpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgY2hyb21lZHJpdmVyID0gYXdhaXQgc2V0dXBOZXdDaHJvbWVkcml2ZXIoe2Nocm9tZUFuZHJvaWRQcm9jZXNzOiAncHJvYyd9KTtcbiAgICAgIGNocm9tZWRyaXZlci5zdGFydC5nZXRDYWxsKDApLmFyZ3NbMF0uY2hyb21lT3B0aW9ucy5hbmRyb2lkUHJvY2Vzc1xuICAgICAgICAuc2hvdWxkLmJlLmVxdWFsKCdwcm9jJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHNldCBsb2dnaW5nUHJlZnMgY2FwYWJpbGl0eScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjaHJvbWVkcml2ZXIgPSBhd2FpdCBzZXR1cE5ld0Nocm9tZWRyaXZlcih7ZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nOiB0cnVlfSk7XG4gICAgICBjaHJvbWVkcml2ZXIuc3RhcnQuZ2V0Q2FsbCgwKS5hcmdzWzBdLmxvZ2dpbmdQcmVmc1xuICAgICAgICAuc2hvdWxkLmRlZXAuZXF1YWwoe3BlcmZvcm1hbmNlOiAnQUxMJ30pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc2V0IGFuZHJvaWRBY3Rpdml0eSB0byBhcHBBY3Rpdml0eSBpZiBicm93c2VyIG5hbWUgaXMgY2hyb21pdW0td2VidmlldycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjaHJvbWVkcml2ZXIgPSBhd2FpdCBzZXR1cE5ld0Nocm9tZWRyaXZlcih7YnJvd3Nlck5hbWU6ICdjaHJvbWl1bS13ZWJ2aWV3JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwQWN0aXZpdHk6ICdhcHBfYWN0J30pO1xuICAgICAgY2hyb21lZHJpdmVyLnN0YXJ0LmdldENhbGwoMCkuYXJnc1swXS5jaHJvbWVPcHRpb25zLmFuZHJvaWRBY3Rpdml0eVxuICAgICAgICAuc2hvdWxkLmJlLmVxdWFsKCdhcHBfYWN0Jyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHNldCBsb2dnaW5nUHJlZnMgY2FwYWJpbGl0eScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjaHJvbWVkcml2ZXIgPSBhd2FpdCBzZXR1cE5ld0Nocm9tZWRyaXZlcih7cGFnZUxvYWRTdHJhdGVneTogXCJzdHJhdGVneVwifSk7XG4gICAgICBjaHJvbWVkcml2ZXIuc3RhcnQuZ2V0Q2FsbCgwKS5hcmdzWzBdLnBhZ2VMb2FkU3RyYXRlZ3lcbiAgICAgICAgLnNob3VsZC5iZS5lcXVhbChcInN0cmF0ZWd5XCIpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
