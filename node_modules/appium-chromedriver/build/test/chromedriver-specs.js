'use strict';

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _libChromedriver = require('../lib/chromedriver');

var _libInstall = require('../lib/install');

var install = _interopRequireWildcard(_libInstall);

var _libUtils = require('../lib/utils');

var utils = _interopRequireWildcard(_libUtils);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _appiumSupport = require('appium-support');

var _teen_process = require('teen_process');

var tp = _interopRequireWildcard(_teen_process);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

_chai2['default'].should();

describe('chromedriver', function () {
  var sandbox = undefined;
  beforeEach(function () {
    sandbox = _sinon2['default'].createSandbox();
  });
  afterEach(function () {
    sandbox.restore();
  });

  describe('getCompatibleChromedriver', function () {
    describe('desktop', function () {
      it('should find generic binary', function callee$3$0() {
        var cd, binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(utils, 'getChromedriverBinaryPath').returns('/path/to/chromedriver');

              cd = new _libChromedriver.Chromedriver({});
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 4:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver');

            case 6:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });

    describe('Android', function () {
      var cd = undefined;
      var getChromedriverBinaryPathSpy = undefined;
      before(function () {
        cd = new _libChromedriver.Chromedriver({
          adb: {
            getApiLevel: function getApiLevel() {
              return 25;
            }
          }
        });
      });
      beforeEach(function () {
        getChromedriverBinaryPathSpy = sandbox.spy(install, 'getChromedriverBinaryPath');
      });
      afterEach(function () {
        getChromedriverBinaryPathSpy.called.should.be['false'];
      });

      it('should find a compatible binary if only one binary exists', function callee$3$0() {
        var binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(utils, 'getChromeVersion').returns('63.0.3239.99');
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver']);
              sandbox.stub(tp, 'exec').returns({
                stdout: 'ChromeDriver 2.36.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 5;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 5:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver');

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should find most recent compatible binary from a number of possibilities', function callee$3$0() {
        var binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(utils, 'getChromeVersion').returns('59.0.3029.42');
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver-36', '/path/to/chromedriver-35', '/path/to/chromedriver-34', '/path/to/chromedriver-33', '/path/to/chromedriver-32', '/path/to/chromedriver-31', '/path/to/chromedriver-30']);
              sandbox.stub(tp, 'exec').onCall(0).returns({
                stdout: 'ChromeDriver 2.36.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.35.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.34.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.33.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.32.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.31.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.30.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 5;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 5:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver-36');

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should correctly determine Chromedriver versions', function callee$3$0() {
        var chromedrivers, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, _step$value, _cd, expectedVersion;

        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver-36', '/path/to/chromedriver-35', '/path/to/chromedriver-34', '/path/to/chromedriver-33', '/path/to/chromedriver-32', '/path/to/chromedriver-31', '/path/to/chromedriver-30']);
              sandbox.stub(tp, 'exec').onCall(0).returns({
                stdout: 'ChromeDriver 2.36.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(1).returns({
                stdout: 'ChromeDriver 2.35.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(2).returns({
                stdout: 'ChromeDriver 2.34.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(3).returns({
                stdout: 'ChromeDriver 2.33.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(4).returns({
                stdout: 'ChromeDriver 2.32.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(5).returns({
                stdout: 'ChromeDriver 2.31.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(6).returns({
                stdout: 'ChromeDriver 2.30.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(cd.getChromedrivers({}));

            case 4:
              chromedrivers = context$4$0.sent;
              _iteratorNormalCompletion = true;
              _didIteratorError = false;
              _iteratorError = undefined;
              context$4$0.prev = 8;

              for (_iterator = _getIterator(_lodash2['default'].zip(chromedrivers, ['2.36', '2.35', '2.34', '2.33', '2.32', '2.31', '2.30'])); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                _step$value = _slicedToArray(_step.value, 2);
                _cd = _step$value[0];
                expectedVersion = _step$value[1];

                _cd.version.should.eql(expectedVersion);
              }
              context$4$0.next = 16;
              break;

            case 12:
              context$4$0.prev = 12;
              context$4$0.t0 = context$4$0['catch'](8);
              _didIteratorError = true;
              _iteratorError = context$4$0.t0;

            case 16:
              context$4$0.prev = 16;
              context$4$0.prev = 17;

              if (!_iteratorNormalCompletion && _iterator['return']) {
                _iterator['return']();
              }

            case 19:
              context$4$0.prev = 19;

              if (!_didIteratorError) {
                context$4$0.next = 22;
                break;
              }

              throw _iteratorError;

            case 22:
              return context$4$0.finish(19);

            case 23:
              return context$4$0.finish(16);

            case 24:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this, [[8, 12, 16, 24], [17,, 19, 23]]);
      });

      it('should find most recent binary from a number of possibilities when chrome is too new', function callee$3$0() {
        var binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(utils, 'getChromeVersion').returns('70.0.0.42');
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver-9000', '/path/to/chromedriver-8999', '/path/to/chromedriver-36', '/path/to/chromedriver-35']);
              sandbox.stub(tp, 'exec').onCall(0).returns({
                stdout: 'ChromeDriver 2.9000.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.8999.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.36.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              }).onCall(0).returns({
                stdout: 'ChromeDriver 2.35.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 5;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 5:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver-9000');

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should search specified directory if provided', function callee$3$0() {
        var cd, binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              cd = new _libChromedriver.Chromedriver({
                adb: {
                  getApiLevel: function getApiLevel() {
                    return 25;
                  }
                },
                executableDir: '/some/local/dir/for/chromedrivers'
              });

              sandbox.stub(utils, 'getChromeVersion').returns('63.0.3239.99');
              sandbox.stub(_appiumSupport.fs, 'glob').withArgs('/some/local/dir/for/chromedrivers/*').returns(['/some/local/dir/for/chromedrivers/chromedriver']);
              sandbox.stub(tp, 'exec').returns({
                stdout: 'ChromeDriver 2.36.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 6:
              binPath = context$4$0.sent;

              binPath.should.eql('/some/local/dir/for/chromedrivers/chromedriver');

            case 8:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should use alternative mapping if provided', function callee$3$0() {
        var cd, binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              cd = new _libChromedriver.Chromedriver({
                adb: {
                  getApiLevel: function getApiLevel() {
                    return 25;
                  }
                },
                mappingPath: _path2['default'].resolve(__dirname, '..', '..', 'test', 'fixtures', 'alt-mapping.json')
              });

              sandbox.stub(utils, 'getChromeVersion').returns('63.0.3239.99');
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver-42']);
              sandbox.stub(tp, 'exec').returns({
                stdout: 'ChromeDriver 2.42.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 6:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver-42');

            case 8:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should use alternative mapping if provided even if semver is broken', function callee$3$0() {
        var cd, binPath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              cd = new _libChromedriver.Chromedriver({
                adb: {
                  getApiLevel: function getApiLevel() {
                    return 25;
                  }
                },
                mappingPath: _path2['default'].resolve(__dirname, '..', '..', 'test', 'fixtures', 'alt-mapping-nonsemver.json')
              });

              sandbox.stub(utils, 'getChromeVersion').returns('63.0.3239.99');
              sandbox.stub(_appiumSupport.fs, 'glob').returns(['/path/to/chromedriver-42']);
              sandbox.stub(tp, 'exec').returns({
                stdout: 'ChromeDriver 2.42.540469 (1881fd7f8641508feb5166b7cae561d87723cfa8)'
              });

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(cd.getCompatibleChromedriver());

            case 6:
              binPath = context$4$0.sent;

              binPath.should.eql('/path/to/chromedriver-42');

            case 8:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
  });

  describe('getMostRecentChromedriver', function () {
    it('should get a value by default', function () {
      (0, _libChromedriver.getMostRecentChromedriver)().should.be.a.string;
    });
    it('should get the most recent version', function () {
      var mapping = {
        '2.12': '36.0.1985',
        '2.11': '36.0.1985',
        '2.10': '33.0.1751',
        '2.9': '31.0.1650',
        '2.8': '30.0.1573',
        '2.7': '30.0.1573',
        '2.6': '29.0.1545'
      };
      (0, _libChromedriver.getMostRecentChromedriver)(mapping).should.eql('2.12');
    });
    it('should handle broken semver', function () {
      var mapping = {
        '2.12': '36.0.1985',
        'v2.11': '36.0.1985',
        '2.10.0.0': '33.0.1751',
        '2.9-beta': '31.0.1650',
        '2.8': '30.0.1573',
        '2.7': '30.0.1573',
        '2.6': '29.0.1545'
      };
      (0, _libChromedriver.getMostRecentChromedriver)(mapping).should.eql('2.12');
    });
    it('should fail for empty mapping', function () {
      (function () {
        return (0, _libChromedriver.getMostRecentChromedriver)({});
      }).should['throw']('Unable to get most recent Chromedriver from empty mapping');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvY2hyb21lZHJpdmVyLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OzsrQkFBd0QscUJBQXFCOzswQkFDcEQsZ0JBQWdCOztJQUE3QixPQUFPOzt3QkFDSSxjQUFjOztJQUF6QixLQUFLOztxQkFDQyxPQUFPOzs7O29CQUNSLE1BQU07Ozs7NkJBQ0osZ0JBQWdCOzs0QkFDZixjQUFjOztJQUF0QixFQUFFOztvQkFDRyxNQUFNOzs7O3NCQUNULFFBQVE7Ozs7QUFFdEIsa0JBQUssTUFBTSxFQUFFLENBQUM7O0FBRWQsUUFBUSxDQUFDLGNBQWMsRUFBRSxZQUFZO0FBQ25DLE1BQUksT0FBTyxZQUFBLENBQUM7QUFDWixZQUFVLENBQUMsWUFBWTtBQUNyQixXQUFPLEdBQUcsbUJBQU0sYUFBYSxFQUFFLENBQUM7R0FDakMsQ0FBQyxDQUFDO0FBQ0gsV0FBUyxDQUFDLFlBQVk7QUFDcEIsV0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0dBQ25CLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsMkJBQTJCLEVBQUUsWUFBWTtBQUNoRCxZQUFRLENBQUMsU0FBUyxFQUFFLFlBQVk7QUFDOUIsUUFBRSxDQUFDLDRCQUE0QixFQUFFO1lBSXpCLEVBQUUsRUFDRixPQUFPOzs7O0FBSmIscUJBQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLDJCQUEyQixDQUFDLENBQzdDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDOztBQUU5QixnQkFBRSxHQUFHLGtDQUFpQixFQUFFLENBQUM7OytDQUNULEVBQUUsQ0FBQyx5QkFBeUIsRUFBRTs7O0FBQTlDLHFCQUFPOztBQUNiLHFCQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDOzs7Ozs7O09BQzdDLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQzs7QUFFSCxZQUFRLENBQUMsU0FBUyxFQUFFLFlBQVk7QUFDOUIsVUFBSSxFQUFFLFlBQUEsQ0FBQztBQUNQ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QyxDQUFDIiwiZmlsZSI6InRlc3QvY2hyb21lZHJpdmVyLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hyb21lZHJpdmVyLCBnZXRNb3N0UmVjZW50Q2hyb21lZHJpdmVyIH0gZnJvbSAnLi4vbGliL2Nocm9tZWRyaXZlcic7XG5pbXBvcnQgKiBhcyBpbnN0YWxsIGZyb20gJy4uL2xpYi9pbnN0YWxsJztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4uL2xpYi91dGlscyc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCAqIGFzIHRwIGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNoYWkuc2hvdWxkKCk7XG5cbmRlc2NyaWJlKCdjaHJvbWVkcml2ZXInLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzYW5kYm94O1xuICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcbiAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENvbXBhdGlibGVDaHJvbWVkcml2ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoJ2Rlc2t0b3AnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIGZpbmQgZ2VuZXJpYyBiaW5hcnknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNhbmRib3guc3R1Yih1dGlscywgJ2dldENocm9tZWRyaXZlckJpbmFyeVBhdGgnKVxuICAgICAgICAgIC5yZXR1cm5zKCcvcGF0aC90by9jaHJvbWVkcml2ZXInKTtcblxuICAgICAgICBjb25zdCBjZCA9IG5ldyBDaHJvbWVkcml2ZXIoe30pO1xuICAgICAgICBjb25zdCBiaW5QYXRoID0gYXdhaXQgY2QuZ2V0Q29tcGF0aWJsZUNocm9tZWRyaXZlcigpO1xuICAgICAgICBiaW5QYXRoLnNob3VsZC5lcWwoJy9wYXRoL3RvL2Nocm9tZWRyaXZlcicpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQW5kcm9pZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjZDtcbiAgICAgIGxldCBnZXRDaHJvbWVkcml2ZXJCaW5hcnlQYXRoU3B5O1xuICAgICAgYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2QgPSBuZXcgQ2hyb21lZHJpdmVyKHtcbiAgICAgICAgICBhZGI6IHtcbiAgICAgICAgICAgIGdldEFwaUxldmVsOiAoKSA9PiAyNSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdldENocm9tZWRyaXZlckJpbmFyeVBhdGhTcHkgPSBzYW5kYm94LnNweShpbnN0YWxsLCAnZ2V0Q2hyb21lZHJpdmVyQmluYXJ5UGF0aCcpO1xuICAgICAgfSk7XG4gICAgICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBnZXRDaHJvbWVkcml2ZXJCaW5hcnlQYXRoU3B5LmNhbGxlZC5zaG91bGQuYmUuZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBmaW5kIGEgY29tcGF0aWJsZSBiaW5hcnkgaWYgb25seSBvbmUgYmluYXJ5IGV4aXN0cycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2FuZGJveC5zdHViKHV0aWxzLCAnZ2V0Q2hyb21lVmVyc2lvbicpXG4gICAgICAgICAgLnJldHVybnMoJzYzLjAuMzIzOS45OScpO1xuICAgICAgICBzYW5kYm94LnN0dWIoZnMsICdnbG9iJylcbiAgICAgICAgICAucmV0dXJucyhbXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyJyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgc2FuZGJveC5zdHViKHRwLCAnZXhlYycpXG4gICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgc3Rkb3V0OiAnQ2hyb21lRHJpdmVyIDIuMzYuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYmluUGF0aCA9IGF3YWl0IGNkLmdldENvbXBhdGlibGVDaHJvbWVkcml2ZXIoKTtcbiAgICAgICAgYmluUGF0aC5zaG91bGQuZXFsKCcvcGF0aC90by9jaHJvbWVkcml2ZXInKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGZpbmQgbW9zdCByZWNlbnQgY29tcGF0aWJsZSBiaW5hcnkgZnJvbSBhIG51bWJlciBvZiBwb3NzaWJpbGl0aWVzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYW5kYm94LnN0dWIodXRpbHMsICdnZXRDaHJvbWVWZXJzaW9uJylcbiAgICAgICAgICAucmV0dXJucygnNTkuMC4zMDI5LjQyJyk7XG4gICAgICAgIHNhbmRib3guc3R1YihmcywgJ2dsb2InKVxuICAgICAgICAgIC5yZXR1cm5zKFtcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItMzYnLFxuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci0zNScsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTM0JyxcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItMzMnLFxuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci0zMicsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTMxJyxcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItMzAnLFxuICAgICAgICAgIF0pO1xuICAgICAgICBzYW5kYm94LnN0dWIodHAsICdleGVjJylcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjM2LjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjM1LjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjM0LjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjMzLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjMyLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjMxLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjMwLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYmluUGF0aCA9IGF3YWl0IGNkLmdldENvbXBhdGlibGVDaHJvbWVkcml2ZXIoKTtcbiAgICAgICAgYmluUGF0aC5zaG91bGQuZXFsKCcvcGF0aC90by9jaHJvbWVkcml2ZXItMzYnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSBkZXRlcm1pbmUgQ2hyb21lZHJpdmVyIHZlcnNpb25zJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYW5kYm94LnN0dWIoZnMsICdnbG9iJylcbiAgICAgICAgICAucmV0dXJucyhbXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTM2JyxcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItMzUnLFxuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci0zNCcsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTMzJyxcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItMzInLFxuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci0zMScsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTMwJyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgc2FuZGJveC5zdHViKHRwLCAnZXhlYycpXG4gICAgICAgICAgLm9uQ2FsbCgwKVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zNi41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCgxKVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zNS41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCgyKVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zNC41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCgzKVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zMy41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCg0KVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zMi41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCg1KVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zMS41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uQ2FsbCg2KVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi4zMC41NDA0NjkgKDE4ODFmZDdmODY0MTUwOGZlYjUxNjZiN2NhZTU2MWQ4NzcyM2NmYTgpJyxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNocm9tZWRyaXZlcnMgPSBhd2FpdCBjZC5nZXRDaHJvbWVkcml2ZXJzKHt9KTtcbiAgICAgICAgZm9yIChjb25zdCBbY2QsIGV4cGVjdGVkVmVyc2lvbl0gb2YgXy56aXAoY2hyb21lZHJpdmVycywgWycyLjM2JywgJzIuMzUnLCAnMi4zNCcsICcyLjMzJywgJzIuMzInLCAnMi4zMScsICcyLjMwJ10pKSB7XG4gICAgICAgICAgY2QudmVyc2lvbi5zaG91bGQuZXFsKGV4cGVjdGVkVmVyc2lvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGZpbmQgbW9zdCByZWNlbnQgYmluYXJ5IGZyb20gYSBudW1iZXIgb2YgcG9zc2liaWxpdGllcyB3aGVuIGNocm9tZSBpcyB0b28gbmV3JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYW5kYm94LnN0dWIodXRpbHMsICdnZXRDaHJvbWVWZXJzaW9uJylcbiAgICAgICAgICAucmV0dXJucygnNzAuMC4wLjQyJyk7XG4gICAgICAgIHNhbmRib3guc3R1YihmcywgJ2dsb2InKVxuICAgICAgICAgIC5yZXR1cm5zKFtcbiAgICAgICAgICAgICcvcGF0aC90by9jaHJvbWVkcml2ZXItOTAwMCcsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTg5OTknLFxuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci0zNicsXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTM1JyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgc2FuZGJveC5zdHViKHRwLCAnZXhlYycpXG4gICAgICAgICAgLm9uQ2FsbCgwKVxuICAgICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgICBzdGRvdXQ6ICdDaHJvbWVEcml2ZXIgMi45MDAwLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAub25DYWxsKDApXG4gICAgICAgICAgICAucmV0dXJucyh7XG4gICAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjg5OTkuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIC5vbkNhbGwoMClcbiAgICAgICAgICAgIC5yZXR1cm5zKHtcbiAgICAgICAgICAgICAgc3Rkb3V0OiAnQ2hyb21lRHJpdmVyIDIuMzYuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIC5vbkNhbGwoMClcbiAgICAgICAgICAgIC5yZXR1cm5zKHtcbiAgICAgICAgICAgICAgc3Rkb3V0OiAnQ2hyb21lRHJpdmVyIDIuMzUuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBiaW5QYXRoID0gYXdhaXQgY2QuZ2V0Q29tcGF0aWJsZUNocm9tZWRyaXZlcigpO1xuICAgICAgICBiaW5QYXRoLnNob3VsZC5lcWwoJy9wYXRoL3RvL2Nocm9tZWRyaXZlci05MDAwJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBzZWFyY2ggc3BlY2lmaWVkIGRpcmVjdG9yeSBpZiBwcm92aWRlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgY2QgPSBuZXcgQ2hyb21lZHJpdmVyKHtcbiAgICAgICAgICBhZGI6IHtcbiAgICAgICAgICAgIGdldEFwaUxldmVsOiAoKSA9PiAyNSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4ZWN1dGFibGVEaXI6ICcvc29tZS9sb2NhbC9kaXIvZm9yL2Nocm9tZWRyaXZlcnMnLFxuICAgICAgICB9KTtcblxuICAgICAgICBzYW5kYm94LnN0dWIodXRpbHMsICdnZXRDaHJvbWVWZXJzaW9uJylcbiAgICAgICAgICAucmV0dXJucygnNjMuMC4zMjM5Ljk5Jyk7XG4gICAgICAgIHNhbmRib3guc3R1YihmcywgJ2dsb2InKVxuICAgICAgICAgIC53aXRoQXJncygnL3NvbWUvbG9jYWwvZGlyL2Zvci9jaHJvbWVkcml2ZXJzLyonKVxuICAgICAgICAgICAgLnJldHVybnMoW1xuICAgICAgICAgICAgICAnL3NvbWUvbG9jYWwvZGlyL2Zvci9jaHJvbWVkcml2ZXJzL2Nocm9tZWRyaXZlcicsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgc2FuZGJveC5zdHViKHRwLCAnZXhlYycpXG4gICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgc3Rkb3V0OiAnQ2hyb21lRHJpdmVyIDIuMzYuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYmluUGF0aCA9IGF3YWl0IGNkLmdldENvbXBhdGlibGVDaHJvbWVkcml2ZXIoKTtcbiAgICAgICAgYmluUGF0aC5zaG91bGQuZXFsKCcvc29tZS9sb2NhbC9kaXIvZm9yL2Nocm9tZWRyaXZlcnMvY2hyb21lZHJpdmVyJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB1c2UgYWx0ZXJuYXRpdmUgbWFwcGluZyBpZiBwcm92aWRlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgY2QgPSBuZXcgQ2hyb21lZHJpdmVyKHtcbiAgICAgICAgICBhZGI6IHtcbiAgICAgICAgICAgIGdldEFwaUxldmVsOiAoKSA9PiAyNSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1hcHBpbmdQYXRoOiBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAndGVzdCcsICdmaXh0dXJlcycsICdhbHQtbWFwcGluZy5qc29uJyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNhbmRib3guc3R1Yih1dGlscywgJ2dldENocm9tZVZlcnNpb24nKVxuICAgICAgICAgIC5yZXR1cm5zKCc2My4wLjMyMzkuOTknKTtcbiAgICAgICAgc2FuZGJveC5zdHViKGZzLCAnZ2xvYicpXG4gICAgICAgICAgLnJldHVybnMoW1xuICAgICAgICAgICAgJy9wYXRoL3RvL2Nocm9tZWRyaXZlci00MicsXG4gICAgICAgICAgXSk7XG4gICAgICAgIHNhbmRib3guc3R1Yih0cCwgJ2V4ZWMnKVxuICAgICAgICAgIC5yZXR1cm5zKHtcbiAgICAgICAgICAgIHN0ZG91dDogJ0Nocm9tZURyaXZlciAyLjQyLjU0MDQ2OSAoMTg4MWZkN2Y4NjQxNTA4ZmViNTE2NmI3Y2FlNTYxZDg3NzIzY2ZhOCknLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGJpblBhdGggPSBhd2FpdCBjZC5nZXRDb21wYXRpYmxlQ2hyb21lZHJpdmVyKCk7XG4gICAgICAgIGJpblBhdGguc2hvdWxkLmVxbCgnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTQyJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB1c2UgYWx0ZXJuYXRpdmUgbWFwcGluZyBpZiBwcm92aWRlZCBldmVuIGlmIHNlbXZlciBpcyBicm9rZW4nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGNkID0gbmV3IENocm9tZWRyaXZlcih7XG4gICAgICAgICAgYWRiOiB7XG4gICAgICAgICAgICBnZXRBcGlMZXZlbDogKCkgPT4gMjUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYXBwaW5nUGF0aDogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3Rlc3QnLCAnZml4dHVyZXMnLCAnYWx0LW1hcHBpbmctbm9uc2VtdmVyLmpzb24nKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2FuZGJveC5zdHViKHV0aWxzLCAnZ2V0Q2hyb21lVmVyc2lvbicpXG4gICAgICAgICAgLnJldHVybnMoJzYzLjAuMzIzOS45OScpO1xuICAgICAgICBzYW5kYm94LnN0dWIoZnMsICdnbG9iJylcbiAgICAgICAgICAucmV0dXJucyhbXG4gICAgICAgICAgICAnL3BhdGgvdG8vY2hyb21lZHJpdmVyLTQyJyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgc2FuZGJveC5zdHViKHRwLCAnZXhlYycpXG4gICAgICAgICAgLnJldHVybnMoe1xuICAgICAgICAgICAgc3Rkb3V0OiAnQ2hyb21lRHJpdmVyIDIuNDIuNTQwNDY5ICgxODgxZmQ3Zjg2NDE1MDhmZWI1MTY2YjdjYWU1NjFkODc3MjNjZmE4KScsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYmluUGF0aCA9IGF3YWl0IGNkLmdldENvbXBhdGlibGVDaHJvbWVkcml2ZXIoKTtcbiAgICAgICAgYmluUGF0aC5zaG91bGQuZXFsKCcvcGF0aC90by9jaHJvbWVkcml2ZXItNDInKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TW9zdFJlY2VudENocm9tZWRyaXZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGdldCBhIHZhbHVlIGJ5IGRlZmF1bHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBnZXRNb3N0UmVjZW50Q2hyb21lZHJpdmVyKCkuc2hvdWxkLmJlLmEuc3RyaW5nO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBtb3N0IHJlY2VudCB2ZXJzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgbWFwcGluZyA9IHtcbiAgICAgICAgJzIuMTInOiAnMzYuMC4xOTg1JyxcbiAgICAgICAgJzIuMTEnOiAnMzYuMC4xOTg1JyxcbiAgICAgICAgJzIuMTAnOiAnMzMuMC4xNzUxJyxcbiAgICAgICAgJzIuOSc6ICczMS4wLjE2NTAnLFxuICAgICAgICAnMi44JzogJzMwLjAuMTU3MycsXG4gICAgICAgICcyLjcnOiAnMzAuMC4xNTczJyxcbiAgICAgICAgJzIuNic6ICcyOS4wLjE1NDUnLFxuICAgICAgfTtcbiAgICAgIGdldE1vc3RSZWNlbnRDaHJvbWVkcml2ZXIobWFwcGluZykuc2hvdWxkLmVxbCgnMi4xMicpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGJyb2tlbiBzZW12ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBtYXBwaW5nID0ge1xuICAgICAgICAnMi4xMic6ICczNi4wLjE5ODUnLFxuICAgICAgICAndjIuMTEnOiAnMzYuMC4xOTg1JyxcbiAgICAgICAgJzIuMTAuMC4wJzogJzMzLjAuMTc1MScsXG4gICAgICAgICcyLjktYmV0YSc6ICczMS4wLjE2NTAnLFxuICAgICAgICAnMi44JzogJzMwLjAuMTU3MycsXG4gICAgICAgICcyLjcnOiAnMzAuMC4xNTczJyxcbiAgICAgICAgJzIuNic6ICcyOS4wLjE1NDUnLFxuICAgICAgfTtcbiAgICAgIGdldE1vc3RSZWNlbnRDaHJvbWVkcml2ZXIobWFwcGluZykuc2hvdWxkLmVxbCgnMi4xMicpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZmFpbCBmb3IgZW1wdHkgbWFwcGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICgoKSA9PiBnZXRNb3N0UmVjZW50Q2hyb21lZHJpdmVyKHt9KSlcbiAgICAgICAgLnNob3VsZC50aHJvdygnVW5hYmxlIHRvIGdldCBtb3N0IHJlY2VudCBDaHJvbWVkcml2ZXIgZnJvbSBlbXB0eSBtYXBwaW5nJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uIn0=
